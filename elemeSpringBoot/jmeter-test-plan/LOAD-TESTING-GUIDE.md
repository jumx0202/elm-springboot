# 饿了么外卖平台 - 综合负载测试指南

## 📋 测试概述

本测试方案使用JMeter实现了三种负载模式的综合测试，包含完整的性能监控和指标采集功能。

### 🎯 测试目标

1. **日常负载测试** - 模拟正常业务负载情况
2. **峰值负载测试** - 验证系统在高并发下的表现
3. **混合负载测试** - 模拟真实用户的多样化行为

## 🔧 测试配置

### 线程组配置

| 测试类型 | 用户数 | 启动时间 | 测试时长 | 循环次数 | 延迟启动 |
|---------|--------|----------|----------|----------|----------|
| 日常负载 | 20 | 60秒 | 5分钟 | 5次 | 0秒 |
| 峰值负载 | 100 | 30秒 | 10分钟 | 10次 | 320秒 |
| 混合负载 | 50 | 120秒 | 15分钟 | 15次 | 950秒 |

### 测试场景分布

#### 日常负载测试
- **商家列表查询** - 模拟用户浏览商家
- **菜品详情查询** - 模拟用户查看菜品信息
- **响应时间要求**: 商家查询 ≤ 1000ms, 菜品查询 ≤ 800ms

#### 峰值负载测试
- **用户登录** - 模拟用户认证
- **商家列表查询** - 高并发商家浏览
- **订单创建** - 模拟下单高峰
- **响应时间要求**: 登录 ≤ 2000ms, 商家查询 ≤ 3000ms, 订单创建 ≤ 5000ms

#### 混合负载测试
- **浏览商家** (40%概率) - 用户浏览行为
- **查看菜品** (30%概率) - 菜品详情查看
- **下单操作** (20%概率) - 订单创建
- **购物车操作** (10%概率) - 购物车管理

## 📊 监控指标

### 核心性能指标

1. **响应时间 (Response Time)**
   - 平均响应时间
   - 95%响应时间
   - 99%响应时间
   - 最大响应时间

2. **错误率 (Error Rate)**
   - HTTP错误率
   - 业务错误率
   - 超时错误率

3. **吞吐量 (Throughput)**
   - 每秒请求数 (RPS)
   - 每秒事务数 (TPS)

### 系统资源监控

1. **CPU监控**
   - CPU使用率
   - 负载平均值 (1分钟、5分钟、15分钟)
   - 阈值告警: 80%

2. **内存监控**
   - 内存使用率
   - 交换区使用情况
   - 阈值告警: 85%

3. **磁盘监控**
   - 磁盘使用率
   - 可用空间
   - 阈值告警: 90%

4. **网络监控**
   - 网络流量 (接收/发送)
   - 连接数统计

5. **应用监控**
   - Spring Boot应用CPU/内存使用
   - 进程状态监控

## 🚀 执行测试

### 1. 准备环境

```bash
# 确保Spring Boot应用运行
cd elemeSpringBoot
mvn spring-boot:run

# 验证应用状态
curl http://localhost:8080/api/business/getAll
```

### 2. 执行综合负载测试

```bash
# 进入测试目录
cd elemeSpringBoot/jmeter-test-plan

# 执行综合负载测试
./run-test.sh comprehensive
```

### 3. 单独执行监控

```bash
# 手动启动系统资源监控
./monitor-system-resources.sh
```

## 📈 测试报告

### 自动生成报告

测试完成后会自动生成以下报告：

1. **HTML性能报告**
   - 位置: `reports/comprehensive-load-report/index.html`
   - 包含详细的性能图表和统计信息

2. **系统监控日志**
   - 位置: `reports/system-monitoring/`
   - 包含CPU、内存、磁盘、网络使用情况

3. **原始结果文件**
   - 位置: `results/comprehensive-load-*.jtl`
   - 可用于进一步分析

### 关键指标解读

#### 性能指标基准

| 指标 | 优秀 | 良好 | 一般 | 需优化 |
|------|------|------|------|--------|
| 平均响应时间 | < 200ms | < 500ms | < 1000ms | > 1000ms |
| 95%响应时间 | < 500ms | < 1000ms | < 2000ms | > 2000ms |
| 错误率 | < 0.1% | < 1% | < 5% | > 5% |
| CPU使用率 | < 50% | < 70% | < 80% | > 80% |
| 内存使用率 | < 60% | < 75% | < 85% | > 85% |

#### 告警阈值

- **红色告警**: CPU > 80%, 内存 > 85%, 磁盘 > 90%
- **黄色告警**: 响应时间超过预期阈值
- **业务告警**: 错误率 > 5%

## 🔍 问题诊断

### 常见性能问题

1. **响应时间过长**
   - 检查数据库连接池配置
   - 分析慢查询日志
   - 检查网络延迟

2. **错误率过高**
   - 查看应用日志
   - 检查数据库连接
   - 验证API接口状态

3. **系统资源不足**
   - CPU使用率过高: 检查代码逻辑，考虑优化算法
   - 内存使用率过高: 检查内存泄漏，优化对象生命周期
   - 磁盘使用率过高: 清理日志文件，检查数据增长

### 性能优化建议

1. **应用层优化**
   - 启用数据库连接池
   - 实现缓存机制 (Redis)
   - 优化SQL查询
   - 使用异步处理

2. **系统层优化**
   - 调整JVM参数
   - 优化操作系统配置
   - 使用负载均衡
   - 实现水平扩展

## 📋 测试检查清单

### 测试前检查

- [ ] Spring Boot应用正常运行
- [ ] 数据库连接正常
- [ ] JMeter环境配置正确
- [ ] 测试数据准备完成
- [ ] 监控脚本权限设置

### 测试执行检查

- [ ] 系统资源监控已启动
- [ ] 测试进程正常运行
- [ ] 实时监控数据正常
- [ ] 无异常错误日志

### 测试后检查

- [ ] 测试报告生成完成
- [ ] 监控数据已保存
- [ ] 关键指标在合理范围
- [ ] 性能瓶颈已识别
- [ ] 优化建议已记录

## 🔄 持续改进

### 测试优化

1. **测试场景扩展**
   - 增加更多业务场景
   - 模拟不同用户行为
   - 添加异常场景测试

2. **监控增强**
   - 集成APM工具
   - 添加业务指标监控
   - 实现自动化告警

3. **自动化集成**
   - CI/CD流水线集成
   - 自动化测试触发
   - 结果自动分析和报告

### 性能基线管理

- 建立性能基线数据
- 定期执行回归测试
- 跟踪性能趋势变化
- 及时发现性能退化

---

## 📞 技术支持

如遇到测试执行问题或需要技术支持，请检查：

1. 应用日志: `elemeSpringBoot/logs/`
2. JMeter日志: `jmeter-test-plan/jmeter.log`
3. 系统监控日志: `reports/system-monitoring/`

**测试文件位置**: `scenarios/load-testing-comprehensive.jmx`
**监控脚本**: `monitor-system-resources.sh`
**执行脚本**: `run-test.sh comprehensive` 