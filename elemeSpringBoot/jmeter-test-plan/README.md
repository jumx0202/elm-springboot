# 饿了么外卖平台JMeter系统测试方案

## 项目概述

本测试方案为仿饿了么外卖平台后端系统设计，基于Spring Boot框架开发的RESTful API进行全面的性能和功能测试。

## 系统架构分析

### 核心模块
- **用户模块** (`/user/*`)：用户注册、登录、邮箱验证
- **商家模块** (`/business/*`)：商家信息查询
- **菜品模块** (`/food/*`)：菜品信息管理
- **购物车模块** (`/cart/*`)：购物车增删改查操作
- **订单模块** (`/order/*`)：订单创建、查询、支付

### 技术栈
- **后端**：Spring Boot 3.3.0 + JPA + MySQL
- **端口**：8080
- **上下文路径**：`/api`
- **数据库**：MySQL 8.0+

## 测试策略

### 1. 测试分类

#### 1.1 功能测试
- **API接口功能验证**
- **业务流程完整性测试**
- **数据一致性验证**
- **异常处理测试**

#### 1.2 性能测试
- **负载测试**：模拟正常用户负载
- **压力测试**：测试系统极限承受能力
- **峰值测试**：模拟高峰期流量
- **稳定性测试**：长时间运行稳定性

#### 1.3 安全测试
- **SQL注入防护**
- **XSS攻击防护**
- **认证授权机制**
- **数据传输安全**

### 2. 测试场景设计

#### 2.1 核心业务流程测试
```
用户注册 → 邮箱验证 → 登录 → 浏览商家 → 查看菜品 → 
添加购物车 → 修改数量 → 生成订单 → 支付 → 查看订单
```

#### 2.2 高并发场景
- **同时登录**：50-200个用户并发登录
- **商家浏览**：大量用户同时浏览商家列表
- **下单高峰**：模拟午餐/晚餐时间下单峰值
- **购物车操作**：并发添加/修改购物车

#### 2.3 异常场景测试
- **网络超时处理**
- **数据库连接异常**
- **无效参数输入**
- **重复提交处理**

## 测试配置

### 3. 环境配置

#### 3.1 JMeter版本
- **推荐版本**：Apache JMeter 5.6.3+
- **Java版本**：JDK 8+

#### 3.2 系统要求
- **被测系统**：确保Spring Boot应用正常运行在8080端口
- **数据库**：MySQL数据库正常连接，包含测试数据
- **网络**：确保JMeter客户端能访问被测系统

### 3.3 测试数据准备

#### 用户测试数据 (`test-data/users.csv`)
```csv
phoneNumber,password,name,email
13800138001,password123,测试用户1,test1@example.com
13800138002,password123,测试用户2,test2@example.com
...
```

#### 商家测试数据
- 确保数据库中有足够的商家数据（建议至少10个商家）
- 每个商家包含完整的信息（名称、地址、评分等）

#### 菜品测试数据
- 每个商家至少包含10-20个菜品
- 菜品信息完整（名称、价格、描述、图片等）

### 4. 测试执行

#### 4.1 启动被测系统
```bash
cd elemeSpringBoot
mvn spring-boot:run
```

#### 4.2 验证系统可用性
```bash
curl -X POST http://localhost:8080/api/business/getAll \
  -H "Content-Type: application/json" \
  -d "{}"
```

#### 4.3 执行JMeter测试

##### GUI模式（开发调试）
```bash
jmeter -t eleme-system-test.jmx
```

##### 命令行模式（正式测试）
```bash
jmeter -n -t eleme-system-test.jmx -l test-results.jtl -e -o html-report/
```

#### 4.4 分场景执行
```bash
# 用户认证测试
jmeter -n -t scenarios/user-auth-test.jmx -l user-auth-results.jtl

# 商家菜品查询测试  
jmeter -n -t scenarios/business-food-test.jmx -l business-food-results.jtl
```

### 5. 性能指标

#### 5.1 响应时间要求
- **登录接口**：< 2秒
- **商家列表**：< 1秒
- **菜品查询**：< 1.5秒
- **购物车操作**：< 1秒
- **订单创建**：< 3秒

#### 5.2 并发用户数
- **基准负载**：50并发用户
- **目标负载**：100并发用户
- **峰值负载**：200并发用户

#### 5.3 系统资源指标
- **CPU利用率**：< 80%
- **内存使用率**：< 85%
- **数据库连接池**：< 80%使用率
- **错误率**：< 1%

### 6. 监控与分析

#### 6.1 系统监控
- **应用性能监控**：Spring Boot Actuator
- **数据库监控**：MySQL性能指标
- **JVM监控**：内存、GC性能

#### 6.2 测试结果分析
- **聚合报告**：平均响应时间、吞吐量、错误率
- **响应时间图表**：识别性能瓶颈
- **错误分析**：定位具体问题原因

### 7. 测试用例详细说明

#### 7.1 用户认证模块测试用例

| 测试用例 | 接口 | 方法 | 预期结果 | 断言 |
|---------|------|------|----------|------|
| 用户登录 | `/user/login` | POST | 返回token和用户信息 | 状态码200，包含"登录成功" |
| 发送验证码 | `/user/sendVerifyCode` | POST | 验证码发送成功 | 包含"验证码已发送" |
| 用户注册 | `/user/register` | POST | 注册成功或失败 | 响应时间<3秒 |

#### 7.2 商家菜品模块测试用例

| 测试用例 | 接口 | 方法 | 预期结果 | 断言 |
|---------|------|------|----------|------|
| 获取商家列表 | `/business/getAll` | POST | 返回商家数组 | 状态码200，响应时间<2秒 |
| 获取商家详情 | `/business/getBusinessById` | POST | 返回具体商家信息 | 包含code和data字段 |
| 获取菜品信息 | `/food/getFoodById` | POST | 返回菜品详情 | 响应时间<1.5秒 |
| 批量获取菜品 | `/food/getAllByIds` | POST | 返回菜品列表 | 响应大小>100字节 |

### 8. 压力测试配置

#### 8.1 负载模型
```
阶段1：预热（5分钟）
- 用户数：10 → 50
- 增长时间：5分钟

阶段2：正常负载（10分钟）
- 用户数：50（持续）
- 持续时间：10分钟

阶段3：峰值负载（5分钟）  
- 用户数：50 → 200
- 增长时间：2分钟，持续3分钟

阶段4：降压（3分钟）
- 用户数：200 → 10
- 降压时间：3分钟
```

#### 8.2 测试参数配置
```properties
# 基础参数
BASE_URL=http://localhost:8080/api
THREAD_COUNT=50
RAMP_PERIOD=60
LOOP_COUNT=10

# 性能参数
CONNECT_TIMEOUT=5000
RESPONSE_TIMEOUT=10000

# 业务参数
MAX_CART_ITEMS=50
MAX_ORDER_AMOUNT=9999.99
```

### 9. 故障模拟

#### 9.1 网络故障
- 连接超时测试
- 响应超时测试
- 网络中断恢复测试

#### 9.2 数据库故障
- 连接池满载测试
- 慢查询模拟
- 数据库重启恢复测试

#### 9.3 业务异常
- 无效数据输入
- 并发操作冲突
- 资源耗尽场景

### 10. 持续集成

#### 10.1 自动化测试
```bash
#!/bin/bash
# ci-test.sh - 持续集成测试脚本

echo "启动系统..."
mvn spring-boot:run &
SPRING_PID=$!

echo "等待系统启动..."
sleep 30

echo "执行JMeter测试..."
jmeter -n -t eleme-system-test.jmx -l results.jtl -e -o report/

echo "清理环境..."
kill $SPRING_PID

echo "测试完成"
```

#### 10.2 Jenkins集成
```groovy
pipeline {
    stages {
        stage('Build') {
            steps {
                sh 'mvn clean package'
            }
        }
        stage('Performance Test') {
            steps {
                sh './ci-test.sh'
                perfReport sourceDataFiles: 'results.jtl'
            }
        }
    }
}
```

### 11. 结果分析与优化建议

#### 11.1 性能瓶颈识别
- **数据库查询优化**：添加索引，优化SQL
- **缓存策略**：Redis缓存热点数据
- **连接池调优**：合理配置数据库连接池
- **JVM调优**：优化内存分配和GC策略

#### 11.2 扩展性建议
- **水平扩展**：负载均衡配置
- **数据库分离**：读写分离，分库分表
- **微服务拆分**：按业务模块拆分服务
- **CDN加速**：静态资源加速

## 注意事项

1. **测试环境隔离**：确保测试不影响生产环境
2. **数据清理**：测试完成后清理测试数据
3. **资源监控**：实时监控系统资源使用情况
4. **结果备份**：保存测试结果用于历史对比
5. **问题追踪**：及时记录和跟踪发现的问题

## 联系方式

如有问题，请联系测试团队或查看项目文档。 