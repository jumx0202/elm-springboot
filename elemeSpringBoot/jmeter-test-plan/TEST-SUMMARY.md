# 饿了么外卖平台 JMeter 测试套件总结

## 🎯 测试覆盖范围

### 1. 功能测试 (Functional Testing)

#### ✅ 用户认证模块 (`./run-test.sh auth`)
- **登录功能测试**: 验证用户登录流程
- **邮箱验证**: 测试邮箱验证码功能
- **密码验证**: 测试密码强度和验证逻辑
- **Token管理**: 验证JWT令牌生成和验证

#### ✅ 商家菜品模块 (`./run-test.sh business`)
- **商家列表查询**: 测试获取所有商家信息
- **商家详情查询**: 测试根据ID获取商家详情
- **菜品信息查询**: 测试单个和批量菜品查询
- **数据一致性**: 验证返回数据的完整性

#### ✅ 购物车操作 (`./run-test.sh cart`)
- **添加商品**: 测试添加商品到购物车
- **查看购物车**: 测试购物车列表展示
- **数量更新**: 测试购物车商品数量修改
- **统计信息**: 测试购物车统计数据获取
- **清空购物车**: 测试购物车清空功能

#### ✅ 订单完整流程 (`./run-test.sh order`)
- **用户登录**: 模拟用户登录获取身份认证
- **浏览商家**: 查看可用商家列表
- **选择商品**: 添加商品到购物车
- **创建订单**: 提交订单信息
- **订单查询**: 查看订单详情和状态
- **支付模拟**: 模拟订单支付流程
- **订单历史**: 查询用户所有订单

### 2. 性能测试 (Performance Testing)

#### ✅ 高并发测试 (`./run-test.sh performance`)
- **并发用户**: 50个并发用户，30秒启动时间
- **高频接口**: 商家列表查询性能测试
- **中频接口**: 菜品查询性能测试
- **响应时间**: 验证接口响应时间 < 500ms
- **吞吐量控制**: 模拟真实用户访问模式

#### ✅ 压力测试
- **极限负载**: 100个并发用户，5分钟持续测试
- **系统稳定性**: 监控系统在高压力下的表现
- **错误率控制**: 确保错误率在可接受范围内
- **资源监控**: 观察CPU、内存使用情况

#### ✅ 稳定性测试
- **长时间运行**: 30分钟持续测试（可选启用）
- **内存泄漏检测**: 监控响应时间变化趋势
- **用户行为模拟**: 包含思考时间的真实用户行为

### 3. 安全测试 (Security Testing)

#### ✅ 注入攻击防护 (`./run-test.sh security`)
- **SQL注入测试**: 验证系统对SQL注入的防护
- **XSS攻击测试**: 测试跨站脚本攻击防护
- **参数污染**: 测试重复参数处理
- **权限绕过**: 测试未授权访问防护

#### ✅ 输入验证测试
- **数据格式验证**: 测试无效格式输入处理
- **边界值测试**: 测试超大/超小值处理
- **空值处理**: 测试空值和null值处理
- **特殊字符**: 测试特殊字符输入处理

### 4. 连接性测试 (Connectivity Testing)

#### ✅ 基础连接 (`./run-test.sh simple`)
- **系统可用性**: 验证服务器是否正常运行
- **API连通性**: 测试关键API接口可达性
- **响应格式**: 验证API返回格式正确性
- **基础功能**: 确保核心功能正常工作

## 📊 测试执行统计

### 测试场景分布
```
简单连接测试    : 1个线程  × 1次循环  = 1个请求
用户认证测试    : 3个线程  × 2次循环  = 6个请求
商家菜品测试    : 5个线程  × 2次循环  = 20个请求
购物车操作测试  : 4个线程  × 2次循环  = 24个请求
订单流程测试    : 3个线程  × 1次循环  = 27个请求
安全测试        : 2个线程  × 1次循环  = 10个请求
性能测试        : 50个线程 × 10次循环 = 1000个请求
```

### 性能基准
- **平均响应时间**: < 50ms (基础功能)
- **95%响应时间**: < 500ms (高并发场景)
- **成功率**: > 95% (正常业务流程)
- **吞吐量**: > 100 TPS (事务/秒)

## 🚀 快速开始

### 执行单个测试
```bash
# 基础连接测试
./run-test.sh simple

# 用户认证测试
./run-test.sh auth

# 完整订单流程测试
./run-test.sh order

# 性能压力测试
./run-test.sh performance

# 安全漏洞测试
./run-test.sh security
```

### 执行完整测试套件
```bash
# 运行所有测试（约15-20分钟）
./run-test.sh all
```

### 查看测试报告
测试完成后，HTML报告将生成在 `./reports/` 目录中：
- 每个测试都有独立的报告文件夹
- 包含详细的性能指标和错误分析
- 支持图表化的结果展示

## 🔧 自定义配置

### 环境变量
```bash
export JMETER_HOME=/path/to/jmeter    # JMeter安装目录
export BASE_URL=http://your-server:8080/api  # 被测服务器地址
```

### 测试参数调整
编辑对应的 `.jmx` 文件可以调整：
- 线程数量（并发用户数）
- 循环次数（每用户执行次数）  
- 启动时间（用户启动间隔）
- 测试持续时间

## 📈 持续集成

### Jenkins集成示例
```groovy
pipeline {
    stages {
        stage('API Test') {
            steps {
                sh './run-test.sh simple'
                sh './run-test.sh auth'
                sh './run-test.sh business'
            }
        }
        stage('Performance Test') {
            steps {
                sh './run-test.sh performance'
            }
        }
    }
    post {
        always {
            publishHTML([
                allowMissing: false,
                alwaysLinkToLastBuild: true,
                keepAll: true,
                reportDir: 'reports',
                reportFiles: '*/index.html',
                reportName: 'JMeter Test Report'
            ])
        }
    }
}
```

## 🛠️ 故障排除

### 常见问题
1. **连接被拒绝**: 确保Spring Boot应用运行在8080端口
2. **404错误**: 检查API路径是否包含 `/api` 前缀
3. **权限错误**: 确保测试脚本有执行权限 `chmod +x run-test.sh`
4. **JMeter未找到**: 设置JMETER_HOME环境变量或将JMeter加入PATH

### 性能调优建议
1. **数据库连接池**: 确保数据库连接池配置合理
2. **JVM参数**: 调整Spring Boot的JVM内存参数
3. **缓存策略**: 对频繁查询的数据启用缓存
4. **索引优化**: 确保数据库查询有适当的索引

## 📝 测试数据

### 测试用户数据
- 手机号范围: 13800138001-13800138999
- 默认密码: 123456
- 测试商家ID: 1-10
- 测试菜品ID: 1-50

### 测试场景数据
参考 `test-data/` 目录中的CSV文件：
- `test-scenarios.csv`: 正常业务场景数据
- `error-scenarios.csv`: 异常和边界情况数据

---

**最后更新**: 2025年6月22日  
**测试套件版本**: v2.0  
**支持的API版本**: Spring Boot 3.3.0 